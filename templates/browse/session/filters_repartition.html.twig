{# DETERMINE FILTERS REPARTITION #}
{% set filtersNumber = [] %}
{% set filtersDuration = [] %}
{% set lights = session.exposures|filter(e => e.type == "LIGHT") %}

{% for e in lights %}
    {% if e.filterName in filtersNumber|keys %}
        {% set filtersNumber = filtersNumber|merge({ (e.filterName): filtersNumber.(e.filterName)+1 }) %}
        {% set filtersDuration = filtersDuration|merge({ (e.filterName): filtersDuration.(e.filterName)+e.exposureS }) %}
    {% else %}
        {% set filtersNumber = filtersNumber|merge({(e.filterName): 1}) %}
        {% set filtersDuration = filtersDuration|merge({(e.filterName): e.exposureS}) %}
    {% endif %}
{% endfor %}
    <div id="audienceChart"></div>
<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        var chartOptions = {
            series: [{{ filtersNumber|join(",") }}],
            chart: {
                height: 220,
                type: 'donut'
            },
            title: {
                text: '{{ 'session.stat_filter_repartition'|trans }}',
                align: 'center',
                style: { fontSize: '11px', fontWeight: 600, color: '#999' }
            },
            plotOptions: {
                pie: {
                    startAngle: 0,
                    donut: {
                        size: '50%',
                        dataLabels: {
                            enabled: true
                        },
                    }
                }
            },
            labels: [
                {% for f, c in filtersNumber %}
                "{{ (f=="")?"N/A":f }} : {{ c }} ({{ filtersDuration[(f)]|format_duration }})" {{ ((loop.revindex0>0)?",") }}
                {% endfor %}
            ],
            colors: [{% for f in filtersNumber|keys %}'{{ filterColorMap[f]|default(filterColorMap[f|lower]|default('#6c757d')) }}'{% if not loop.last %},{% endif %}{% endfor %}],
            legend: {
                show: true,
                position: 'right',
                fontSize: '11px',
                labels: { colors: ['#ccc'] }
            },
            dataLabels: { enabled: false },
            stroke: { width: 1, colors: ['rgba(0,0,0,0.3)'] },
            responsive: [
                {
                    breakpoint: 1400,
                    options: { chart: { height: 200 } }
                },
                {
                    breakpoint: 992,
                    options: { chart: { height: 180 } }
                }
            ]
        }
        var audienceChart = new ApexCharts(document.querySelector("#audienceChart"), chartOptions);
        audienceChart.render();
    });
</script>